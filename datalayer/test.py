from backend.es import ElasticsearchBackend
from elasticsearch import Elasticsearch

from utils.utility import convert_second_2_datetime
import time

es_opts={
    "host": "localhost",
    "port": 9200,
    "index_mapping": {
        "name": "test"
    }
}

elk = ElasticsearchBackend(**es_opts)

image = b'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'

metadata = {
    "globalId": 213412,
    "cameraId": '192.168.2.3',                    
    "timeStart": convert_second_2_datetime(time.time()),
    "objectImage": image.decode("utf-8") 
    }

index = 'name'

for _ in range(10):
    elk.insert(index, metadata)

query = {
  "query": {
    "match_all":{}
  }
}

response = elk.search(index=index, es_query=query, scroll='5m')

print(len(response))



# # hosts = {
# #     "host": "localhost",
# #     "port": 9200
# # }

# host = "localhost"
# port = 9200

# # index name
# index_mapping = {
#     "name": "test"
# }

# index = "name"

# elk = ElasticsearchBackend(host=host, port=port, index_mapping=index_mapping)

# document = {
#     "globalId": str(2023092025),
#     "startTime": convert_second_2_datetime(time.time()),
#     "image": "abcdefghijk",
#     "camId": 5
# }

# # # print(type(document))
# # elk.insert(index=index, body=document)

# # res = elk._search(index=index)

# # print(res['hits']['hits'])

# string = b'asfasfas'
# print(type(string))

# import datetime

